<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
 Copyright 2010 Google Inc.
 Licensed under the Apache License, Version 2.0:
 http://www.apache.org/licenses/LICENSE-2.0
 -->

<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>Google Maps JavaScript API v3 Example: Optimized Directions</title>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
  var directionDisplay;
  var directionsService = new google.maps.DirectionsService();
  var map;
  var origin = null;
  var destination = null;
  var waypoints = [];
  var markers = [];
  var directionsVisible = false;
  var polygone;
  var coords = [];
  var geocoder;
  var map;
  var haies = [];
  var terrasses = [];
  var listenerMap;

  function initialize() {
  geocoder = new google.maps.Geocoder();
    directionsDisplay = new google.maps.DirectionsRenderer();
    var myOptions = {
      zoom:17,
      mapTypeId: google.maps.MapTypeId.SATELLITE,
      center: new google.maps.LatLng(48.924459, 2.360164),
    }
    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    directionsDisplay.setMap(map);
    directionsDisplay.setPanel(document.getElementById("directionsPanel"));
		
    listenerMap=google.maps.event.addListener(map, 'click', function(event) {
	if (waypoints.length < 20) {
	  waypoints.push({ location: destination, stopover: true });
	  destination = event.latLng;
	  addMarker(destination);
	  //addHaie(destination);
	  if(!coords.length) coords[0]=destination;
	  else coords[coords.length-1]=destination;
	  coords[coords.length]=coords[0];
	  tracePolygone(coords);
	} else {
	  alert("Maximum number of waypoints reached");
	}
    });
	
  }
  
  function addHaies(){
	google.maps.event.removeListener(listenerMap);
	
	listenerMap=google.maps.event.addListener(map, 'click', function(event) {
	  destination = event.latLng;
	  addHaie(destination);
    });
  }
  
  function addTerrasses(){
	google.maps.event.removeListener(listenerMap);
	
	listenerMap=google.maps.event.addListener(map, 'click', function(event) {
	  destination = event.latLng;
	  addTerrasse(destination);
    });
  }
  
    function traceContours(){
	google.maps.event.removeListener(listenerMap);
	
	listenerMap=google.maps.event.addListener(map, 'click', function(event) {
	if (waypoints.length < 20) {
	  waypoints.push({ location: destination, stopover: true });
	  destination = event.latLng;
	  addMarker(destination);
	  //addHaie(destination);
	  if(!coords.length) coords[0]=destination;
	  else coords[coords.length-1]=destination;
	  coords[coords.length]=coords[0];
	  tracePolygone(coords);
	} else {
	  alert("Maximum number of waypoints reached");
	}
    });
  }
  
  function tracePolygone(coords){
	if(coords.length > 3){
		if(coords.length > 4) polygone.setMap(null);
		// Construct the polygon.
		polygone = new google.maps.Polygon({
		paths: coords,
		strokeColor: '#FF0000',
		strokeOpacity: 0.8,
		strokeWeight: 2,
		fillColor: '#FF0000',
		fillOpacity: 0.35
		});
		polygone.setMap(map);
  }
  }

  function addMarker(latlng) {
    markers.push(new google.maps.Marker({
      position: latlng,
      map: map,
      icon: "http://maps.google.com/mapfiles/marker" + String.fromCharCode(markers.length + 65) + ".png"
    }));
  }

  function addHaie(latlng) {
    haies.push(new google.maps.Marker({
      position: latlng,
      map: map,
      icon: "http://rlv.zcache.fr/haie_de_cedre_modeles_de_cartes_de_visite-r902f1bde785949c6ae6b9de0c544bb11_i579u_8byvr_50.jpg"
    }));
  }

  function addTerrasse(latlng) {
    terrasses.push(new google.maps.Marker({
      position: latlng,
      map: map,
      icon: "http://www.amenager-ma-maison.com/1626-small/dalle-terrasse-composite.jpg"
    }));
  }
  
  function clearMarkers() {
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
    }
	polygone.setMap(null);
	coords = [];
	markers = [];
  }
  
  function clearTerrasses() {
    for (var i = 0; i < terrasses.length; i++) {
      terrasses[i].setMap(null);
    }
	terrasses = [];
  }
  
  function clearHaies() {
    for (var i = 0; i < haies.length; i++) {
      haies[i].setMap(null);
    }
	haies = [];
  }

  function clearWaypoints() {
    markers = [];
    origin = null;
    destination = null;
    waypoints = [];
    directionsVisible = false;
  }

  function reset() {
	clearTerrasses();
	clearHaies();
    clearMarkers();
    clearWaypoints();
    directionsDisplay.setMap(null);
    directionsDisplay.setPanel(null);
    directionsDisplay = new google.maps.DirectionsRenderer();
    directionsDisplay.setMap(map);
    directionsDisplay.setPanel(document.getElementById("directionsPanel"));
  }
  
	function codeAddress() {
	var address = document.getElementById('address').value;
	geocoder.geocode( { 'address': address}, function(results, status) {
	if (status == google.maps.GeocoderStatus.OK) {
	  map.setCenter(results[0].geometry.location);
	} else {
	  alert('Geocode was not successful for the following reason: ' + status);
	}
	});
	}
	
	function calcArea(){
	alert(google.maps.geometry.spherical.computeArea(coords)+" mÂ²");
	}
  
</script>
</head>
<body onload="initialize()" style="font-family: sans-serif;">
  <table style="width: 400px">

    <tr>
      <td><input type="checkbox" id="optimize" checked />Optimize</td>
    </tr>
    <tr>
      <td><input type="button" value="Reset" onclick="reset()" /></td>
	  <td><input type="button" value="Clear Haies" onclick="clearHaies()" /></td>
	  <td><input type="button" value="Clear Terrasses" onclick="clearTerrasses()" /></td>
	  <td><input type="button" value="Clear Coutours" onclick="clearMarkers()" /></td>
    </tr>
    <tr>
      <td><input type="button" value="Get Area!" onclick="calcArea()" /></td>
      <td></td>
    </tr>
  </table>
  <div style="position:relative; border: 1px; width: 610px; height: 400px;">
    <div id="map_canvas" style="border: 1px solid black; position:absolute; width:398px; height:398px"></div>
    <div id="directionsPanel" style="position:absolute; left: 410px; width:240px; height:400px; overflow: auto"></div>
  </div>
  <div id="panel">
      <input id="address" type="textbox" value="Fouesnant">
      <input type="button" value="Search" onclick="codeAddress()">
    </div>
	<div>
      <input type="button" value="Trace contours" onclick="traceContours()">
    </div>
	<div>
      <input type="button" value="Add Haies" onclick="addHaies()">
    </div>
	<div>
      <input type="button" value="Add Terrasses" onclick="addTerrasses()">
    </div>
</body>
</html>
